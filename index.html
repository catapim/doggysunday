<html>
<script src="./js/planck.min.js"></script>

<body>
    <canvas width="640" height="480" id="canvas">

    </canvas>
</body>
<script src="./js/world.js"></script>
<script src="./js/fence.js"></script>
<script src="./js/sheep.js"></script>

<script src="./js/controls.js"></script>

<script>


    // rendering loop

    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    var start=Date.now();


    function loop() {
        let current = Date.now(), elapsed = current - start;
        world.step(1/60,elapsed/1000);

        // in each frame call world.step(timeStep) with fixed timeStep
        start = current;
        
        // iterate over bodies and fixtures
        ctx.clearRect(0, 0, WIDTH, HEIGHT);

        for (let body = world.getBodyList(); body; body = body.getNext()) {
            // for (var fixture = body.getFixtureList(); fixture; fixture = fixture.getNext()) {
            //     // draw or update fixture
            // }
         
            let p = body.getPosition();
            if (body.getUserData() == "fence") {
                ctx.fillStyle = "#000000";
                let shape=body.getFixtureList().getShape();


                ctx.moveTo(p.x, p.y);
                ctx.lineTo(p.x+shape.getVertex(0).x, p.y+shape.getVertex(0).y);
                ctx.lineTo(p.x+shape.getVertex(1).x, p.y+shape.getVertex(1).y);
                ctx.lineTo(p.x+shape.getVertex(2).x, p.y+shape.getVertex(2).y);
                ctx.lineTo(p.x+shape.getVertex(3).x, p.y+shape.getVertex(3).y);

                ctx.stroke();
            } else if (body.getUserData() == "sheep") {
                ctx.fillStyle = "#00FF00";
                ctx.fillRect(p.x-8, p.y-8, 16, 16);


            } else {
               
                ctx.fillStyle = "#FF0000";

           
                ctx.fillRect(p.x-8, p.y-8, 16, 16);

            }
            

        }
        // move dog
        dogBody.setLinearVelocity(Vec2(x_axis, y_axis));
        // request a new frame
        window.requestAnimationFrame(loop);

    }
    window.requestAnimationFrame(loop);


</script>

</html>